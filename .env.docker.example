# ===========================================
# ATLASP2P - LOCAL DOCKER MODE CONFIGURATION
# ===========================================
# This file is a TEMPLATE.
#
# Setup Instructions:
#   1. Run: make setup-docker
#   2. This copies to .env (gitignored)
#   3. Edit .env with your credentials if needed
#   4. Run: make docker-dev
#
# Mode: Full local stack (PostgreSQL + Supabase + Web + Crawler)
# Use when: Developing without cloud dependencies
#
# Services included:
#   - PostgreSQL (database)
#   - Kong (API gateway on port 4020)
#   - GoTrue (authentication)
#   - PostgREST (REST API)
#   - Supabase Studio (UI on port 4022)
#   - Next.js (web app on port 4000)
#   - Python (crawler)
#   - Inbucket (email testing on port 4023)
# ===========================================

# -------------------------------------------
# DOCKER COMPOSE
# -------------------------------------------
# Docker Compose Project Name
# Controls container and image naming (e.g., atlasp2p-web, atlasp2p-db)
COMPOSE_PROJECT_NAME=atlasp2p

# -------------------------------------------
# DOCKER SUPABASE (LOCAL)
# -------------------------------------------
# PostgreSQL
POSTGRES_PASSWORD=postgres
POSTGRES_DB=postgres

# JWT Secret (generate new: openssl rand -base64 32)
JWT_SECRET=super-secret-jwt-token-with-at-least-32-characters-long

# Cron Job Secret (security token for cron endpoints)
# Generate with: openssl rand -hex 32
# CRITICAL: Change this in production!
CRON_SECRET=your-super-secret-cron-token-change-in-production-min-32-chars

# Supabase Keys (LOCAL ONLY - these are demo keys)
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU

# Supabase URLs (Local Docker)
NEXT_PUBLIC_SUPABASE_URL=http://localhost:4020

# Supabase API URL (used by crawler for database access)
# Docker mode: Use internal Docker network URL
SUPABASE_URL=http://kong:8000

# Supabase Internal URL (server-side container-to-container communication)
# Used by Next.js server for database calls within Docker network
SUPABASE_INTERNAL_URL=http://kong:8000

# Studio
DEFAULT_ORGANIZATION_NAME=AtlasP2P
DEFAULT_PROJECT_NAME=AtlasP2P

# Auth
# NOTE: Must match WEB_PORT and KONG_PORT above
GOTRUE_SITE_URL=http://localhost:4000
GOTRUE_URI_ALLOW_LIST=http://localhost:4000
API_EXTERNAL_URL=http://localhost:4020

# SMTP (Inbucket for email testing - local development only)
SMTP_ADMIN_EMAIL=admin@localhost
SMTP_SENDER_NAME=AtlasP2P
SMTP_HOST=inbucket
SMTP_PORT=2500
GOTRUE_MAILER_AUTOCONFIRM=true
GOTRUE_MAILER_EXTERNAL_HOSTS=localhost,kong

# -------------------------------------------
# EMAIL SERVICE SECRETS (PRODUCTION)
# -------------------------------------------
# Choose ONE provider (configured in project.config.yaml)
# All are optional for local development (uses Inbucket)

# Resend (recommended - https://resend.com)
RESEND_API_KEY=

# SendGrid (alternative - https://sendgrid.com)
SENDGRID_API_KEY=

# Custom SMTP (if using 'smtp' provider in config)
SMTP_USER=
SMTP_PASSWORD=
SMTP_TLS=true

# -------------------------------------------
# SECURITY - TURNSTILE (CLOUDFLARE)
# -------------------------------------------
# Cloudflare Turnstile for bot protection
# Get keys at: https://dash.cloudflare.com/turnstile
#
# NOTE: Turnstile config (enabled, siteKey, protectedActions) is in config/project.config.yaml
# ONLY the secret key goes in .env for security!
TURNSTILE_SECRET_KEY=0x4AAAAAACHmrfqdjuWH8nhgwEVTDHAqZTE

# -------------------------------------------
# DEVELOPMENT SETTINGS
# -------------------------------------------
NODE_ENV=development

# ===========================================
# PORT CONFIGURATION
# ===========================================
# All exposed ports - single source of truth
# Change these to run multiple instances or avoid conflicts
PORT=4000                      # Web app (Next.js)
WEB_PORT=4000                  # Web app external (same as PORT)
DB_PORT=4021                   # PostgreSQL direct access
KONG_PORT=4020                 # Supabase API Gateway
STUDIO_PORT=4022               # Supabase Studio UI
INBUCKET_WEB_PORT=4023         # Email testing UI
INBUCKET_SMTP_PORT=4024        # Email testing SMTP

# -------------------------------------------
# GEOIP CONFIGURATION
# -------------------------------------------
GEOIP_DB_PATH=/app/data/geoip

# MaxMind credentials (optional - get free account at maxmind.com)
# If not provided, crawler will download once and cache
MAXMIND_ACCOUNT_ID=
MAXMIND_LICENSE_KEY=

# -------------------------------------------
# ===========================================
# RPC CONFIGURATION (OPTIONAL)
# ===========================================
# Crawler can optionally connect to your local blockchain node's RPC for additional peer discovery.
# This is NOT required - crawler works fine with just DNS seeds.
#
# UNCOMMENT these lines if you have a local node running:
# RPC_HOST=host.docker.internal  # macOS/Windows, use 172.17.0.1 on Linux
# RPC_PORT=8332
# RPC_USER=rpcuser
# RPC_PASS=rpcpassword
#
# Note: host.docker.internal only works on Docker Desktop (macOS/Windows)
# On Linux, use 172.17.0.1 (Docker bridge gateway) or your host IP
# ===========================================
# PRODUCTION DEPLOYMENT (REQUIRED FOR PROD)
# ===========================================
# These are ONLY needed when deploying to production with Caddy SSL
# Not needed for local development (make docker-dev / make cloud-dev)
#
# Usage:
#   make prod-docker   # Production with Caddy SSL
#   make prod-cloud    # Production cloud mode with Caddy SSL
#
# For CI/CD deployment, add these as GitHub Secrets or AWS Parameter Store
# See docs/CICD.md for complete deployment guide
# ===========================================

# Your production domain (e.g., nodes.yourcoin.org)
# DOMAIN=nodes.example.com

# Email for Let's Encrypt SSL certificate notifications
# ACME_EMAIL=admin@example.com

# ===========================================
# DOCKER REGISTRY CONFIGURATION (CI/CD)
# ===========================================
# These variables are automatically injected by the CI/CD workflow
# You DON'T need to set these manually - they're shown here for reference
#
# The workflow reads registry config from config/project.config.yaml
# and injects these vars before deployment
#
# For GHCR (GitHub Container Registry):
#   REGISTRY_TYPE=ghcr
#   REGISTRY_PUBLIC=true
#   REGISTRY=ghcr.io/your-org
#   IMAGE_PREFIX=atlasp2p-
#   IMAGE_TAG=latest
#
# For ECR (AWS Elastic Container Registry):
#   REGISTRY_TYPE=ecr
#   REGISTRY_PUBLIC=false
#   REGISTRY_REGION=us-east-1
#   REGISTRY=123456789.dkr.ecr.us-east-1.amazonaws.com
#   IMAGE_PREFIX=atlasp2p/
#   IMAGE_TAG=latest
#
# See docs/CICD.md for complete registry configuration guide
